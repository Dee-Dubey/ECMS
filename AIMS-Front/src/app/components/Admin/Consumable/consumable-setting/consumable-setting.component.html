<div class="layout">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- SIDEBAR -->
  <div class="sidebar">

    <div class="sidebar-header">
      <h3>Consumable</h3>
    </div>

    <div class="sidebar-menu">

      <div class="menu-item" [ngClass]="{active: activeSection==='category'}" (click)="activeSection='category'">
        <span class="menu-icon">üìÇ</span>
        Category
      </div>

      <div class="menu-item" [ngClass]="{active: activeSection==='supplier'}" (click)="activeSection='supplier'">
        <span class="menu-icon">üöö</span>
        Supplier
      </div>

      <div class="menu-item" [ngClass]="{active: activeSection==='location'}" (click)="activeSection='location'">
        <span class="menu-icon">üìç</span>
        Location
      </div>

      <div class="menu-item" [ngClass]="{active: activeSection==='company'}" (click)="activeSection='company'">
        <span class="menu-icon">üè¢</span>
        Company
      </div>

    </div>

  </div>

  <!-- CONTENT AREA -->
  <div class="content">

    <div class="card">

      <!-- CARD HEADER -->
      <div class="user-header shadow-sm mb-3">
        <div class="d-flex justify-content-between align-items-center flex-wrap">

          <!-- LEFT SIDE -->
          <div class="d-flex align-items-center">

            <div class="header-icon-box mx-3">
              <i class="bi" [ngClass]="getSectionIcon()"></i>
            </div>

            <div>
              <h4 class="mb-0 fw-bold">
                {{ activeSection | titlecase }} Management
              </h4>
              <small class="text-muted">
                Manage {{ activeSection | titlecase }} records and settings
              </small>
            </div>

          </div>

          <!-- RIGHT SIDE BUTTONS -->
          <div class="d-flex gap-2 mt-3 mt-md-0">

            <!-- CREATE BUTTON -->
            <button
              class="btn btn-primary shadow-sm"
              data-bs-toggle="modal"
              data-bs-target="#createModal"
              [disabled]="userRights.hardwareDepartment.electronicDevice.manage === 0">
              <i class="bi bi-plus-lg me-1"></i>
              Create
            </button>

            <!-- EXPORT BUTTON -->
            <button
              class="btn btn-outline-primary shadow-sm" (click)="exportToExcel()"
              [disabled]="userRights.hardwareDepartment.electronicDevice.manage === 0">
              <i class="bi bi-download me-1"></i>
              Export
            </button>

          </div>

        </div>
      </div>

      <!-- SEARCH -->
      <div class="search-wrapper">
        <input type="text" [(ngModel)]="searchText" placeholder="Search..." />
      </div>

      <!-- TABLE -->
      <div class="table-scroll-wrapper">
        <table class="custom-table">

          <!-- ================= CATEGORY ================= -->
          <thead class="custom-table-head" *ngIf="activeSection==='category'">
            <tr>
              <th class="text-center" style="width:40px;">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectAll"
                    (change)="toggleSelectAll($event)">
                </div>
              </th>
              <th>#</th>
              <th>Name</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>

          <tbody *ngIf="activeSection==='category'">
            <!-- <tr *ngFor="let category of inCategoriesList; let i=index"> -->
            <tr *ngFor="let category of filteredData; let i=index">
              <td class="text-center">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectedRows.includes(category)"
                    (change)="toggleRowSelection(category, $event)">
                </div>
              </td>
              <td>{{i+1}}</td>
              <td>{{category.categoryName}}</td>
              <td class="text-center">
                <button class="btn btn-submit" data-bs-toggle="modal" data-bs-target="#editModal" [ngClass]="{disabled: userRights?.adminDepartment?.consumableAsset?.manage === 0}" (click)="editCategory(category)"> Edit </button>
              </td>
            </tr>
          </tbody>

          <!-- ================= SUPPLIER ================= -->
          <thead class="custom-table-head" *ngIf="activeSection==='supplier'">
            <tr>
              <th class="text-center" style="width:40px;">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectAll"
                    (change)="toggleSelectAll($event)">
                </div>
              </th>
              <th>#</th>
              <th>Supplier Name</th>
              <th>Contact Person</th>
              <th>Contact Number</th>
              <th>E-Mail</th>
              <th>GST Number</th>
              <th>Address</th>
              <th>Type</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>

          <tbody *ngIf="activeSection==='supplier'">
            <tr *ngFor="let supplier of filteredData; let i=index">
              <td class="text-center">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectedRows.includes(supplier)"
                    (change)="toggleRowSelection(supplier, $event)">
                </div>
              </td>
              <td>{{i+1}}</td>
              <td>{{supplier.supplierName}}</td>
              <td>{{supplier.contactPerson}}</td>
              <td>{{supplier.contactNumber}}</td>
              <td>{{supplier.email}}</td>
              <td>{{supplier.GSTNumber}}</td>
              <td>{{supplier.address}}</td>
              <td>{{supplier.type}}</td>
              <td class="text-center">
                <button class="btn btn-submit" data-bs-toggle="modal" data-bs-target="#editModal" [ngClass]="{disabled: userRights?.adminDepartment?.consumableAsset?.manage === 0}" (click)="editSupplier(supplier)"> Edit </button>
              </td>
            </tr>
          </tbody>

          <!-- ================= LOCATION ================= -->
          <thead class="custom-table-head" *ngIf="activeSection==='location'">
            <tr>
              <th class="text-center" style="width:40px;">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectAll"
                    (change)="toggleSelectAll($event)">
                </div>
              </th>
              <th>#</th>
              <th>Shelf Name</th>
              <th>Shelf Location</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>

          <tbody *ngIf="activeSection==='location'">
            <tr *ngFor="let location of filteredData; let i=index">
              <td class="text-center">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectedRows.includes(location)"
                    (change)="toggleRowSelection(location, $event)">
                </div>
              </td>
              <td>{{i+1}}</td>
              <td>{{location.locationName}}</td>
              <td>{{location.shelfLocation}}</td>
              <td class="text-center">
                <button class="btn btn-submit" data-bs-toggle="modal" data-bs-target="#editModal" [ngClass]="{disabled: userRights?.adminDepartment?.consumableAsset?.manage === 0}" (click)="editLocation(location)"> Edit </button>
              </td>
            </tr>
          </tbody>

          <!-- ================= COMPANY ================= -->
          <thead class="custom-table-head" *ngIf="activeSection==='company'">
            <tr>
              <th class="text-center" style="width:40px;">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectAll"
                    (change)="toggleSelectAll($event)">
                </div>
              </th>
              <th scope="col" class="align-middle background-dark">#</th>
              <th scope="col" class="align-middle background-dark">Company Name</th>
              <th scope="col" class="align-middle background-dark">Abbreviation</th>
              <th scope="col" class="align-middle background-dark">GST Number</th>
              <th scope="col" class="align-middle background-dark">Address</th>
              <th scope="col" colspan="2" class="align-middle background-dark">Action</th>
            </tr>
          </thead>

          <tbody *ngIf="activeSection==='company'">
            <tr *ngFor="let company of filteredData; let i=index">
              <td class="text-center">
                <div class="form-check m-0 d-flex justify-content-center">
                  <input class="form-check-input custom-checkbox"
                    type="checkbox"
                    [checked]="selectedRows.includes(company)"
                    (change)="toggleRowSelection(company, $event)">
                </div>
              </td>
              <td>{{i+1}}</td>
              <td>{{company.companyName}}</td>
              <td>{{company.abbreviation}}</td>
              <td>{{company.GSTNumber}}</td>
              <td>{{company.address}}</td>
              <td class="text-center">
                <button class="btn btn-submit" data-bs-toggle="modal" data-bs-target="#editModal" [ngClass]="{disabled: userRights?.adminDepartment?.consumableAsset?.manage === 0}" (click)="editCompany(company)"> Edit </button>
              </td>
            </tr>
          </tbody>

        </table>

        <div *ngIf="filteredData.length === 0">
          <span colspan="10" class="text-center no-data-row">
            No data found for "{{ searchText }}"
          </span>
        </div>
      </div>

    </div>

  </div>

</div>

<!-- UNIVERSAL CREATE MODAL -->
<div class="modal fade" id="createModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">

  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          Create {{activeSection | titlecase}}
        </h5>
        <button type="button" id="createModalCloseBtn" class="btn-close" data-bs-dismiss="modal"> </button>
      </div>

      <div class="modal-body">

        <!-- CATEGORY -->
        <form *ngIf="activeSection==='category'" [formGroup]="createCategoryForm" (ngSubmit)="submitConsumableCategory()">

          <label for="categoryname" class="form-label"> Category Name <span class="required">*</span></label>
          <input type="text" class="form-control" formControlName="categoryName">
          <small class="error-message" *ngIf="createCategoryForm.controls['categoryName'].errors?.['required'] && createCategoryForm.controls['categoryName'].touched">This field is required</small>
          <small class="error-message" *ngIf="createCategoryForm.controls['categoryName'].errors?.['notUnique'] && createCategoryForm.controls['categoryName'].touched">Name already exists!</small>

          <div class="text-end mt-3">
            <button type="submit" class="btn btn-submit" [disabled]="createCategoryForm.invalid">
              Save
            </button>
          </div>
        </form>


        <!-- SUPPLIER -->
        <form *ngIf="activeSection==='supplier'" [formGroup]="createSupplierForm" (ngSubmit)="submitSupplier()">
          <div class="row">

            <div class="col-6 mb-3">
              <label> Supplier Name <span class="required">*</span></label>
              <input type="text" class="form-control" formControlName="supplierName">
              <small class="error-message" *ngIf="createSupplierForm.controls['supplierName'].errors?.['required'] && createSupplierForm.controls['supplierName'].touched">This field is Required</small>
              <small class="error-message" *ngIf="createSupplierForm.controls['supplierName'].errors?.['notUnique']">Supplier name is already exist!</small>
            </div>

            <div class="col-6 mb-3">
              <label>Contact Person</label>
              <input type="text" class="form-control" formControlName="contactPerson">
               <!-- <small class="error-message" *ngIf="createSupplierForm.controls['contactPerson'].errors?.['notUnique']">Contact person is already exist!</small> -->
            </div>

            <div class="col-6 mb-3">
              <label>Contact Number</label>
              <input type="text" class="form-control" formControlName="contactNumber">
               <!-- <small class="error-message" *ngIf="createSupplierForm.controls['contactNumber'].errors?.['notUnique']">Contact Number is already exist!</small> -->
            </div>

            <div class="col-6 mb-3">
              <label>Email</label>
              <input type="text" class="form-control" formControlName="email">
              <!-- <small class="error-message" *ngIf="createSupplierForm.controls['email'].errors?.['notUnique']">Email is already exist!</small> -->
            </div>

            <div class="col-6 mb-3">
              <label>GST Number</label>
              <input type="text" class="form-control" formControlName="GSTNumber">
              <!-- <small class="error-message" *ngIf="createSupplierForm.controls['GSTNumber'].errors?.['notUnique']"> GST number is already exist!</small> -->
            </div>

            <div class="col-6 mb-3">
              <label>Address</label>
              <input type="text" class="form-control" formControlName="address">
              <!-- <small class="error-message" *ngIf="createSupplierForm.controls['address'].errors?.['notUnique']"> Address is already exist!</small> -->
            </div>

            <div class="col-6 mb-3">
              <label>Type</label>
              <select class="form-select" formControlName="type">
                <option value="Local">Local</option>
                <option value="Imported">Imported</option>
              </select>
            </div>

          </div>

          <div class="text-end">
            <button type="submit" class="btn btn-submit" [disabled]="createSupplierForm.invalid">
              Save
            </button>
          </div>
        </form>

        <!-- LOCATION -->
        <form *ngIf="activeSection==='location'" [formGroup]="createLocationForm" (ngSubmit)="submitLocation()">

          <div class="row">

            <div class="col-6 mb-3">
              <label> Location Name <span class="required">*</span> </label>
              <input type="text" class="form-control" formControlName="locationName">

              <small class="error-message"
                *ngIf="createLocationForm.controls['locationName'].errors?.['required'] && createLocationForm.controls['locationName'].touched">
                This field is Required
              </small>
              <small class="error-message"
                *ngIf="createLocationForm.controls['locationName'].errors?.['notUnique']">
                Location name is already exist!
              </small>
            </div>

            <div class="col-6 mb-3">
              <label>Shelf Location <span class="required">*</span> </label>
              <input type="text" class="form-control" formControlName="shelfLocation">

              <small
                *ngIf="createLocationForm.controls['shelfLocation']?.errors?.['maxlength'] && createLocationForm.controls['shelfLocation']?.touched" class="error-message">
                Name cannot exceed 30 characters.
              </small>
            </div>

          </div>

          <div class="text-end mt-3">
            <button type="submit" class="btn btn-submit" [disabled]="createLocationForm.invalid">
              Save
            </button>
          </div>
        </form>

        <!-- COMPANY -->
        <form *ngIf="activeSection==='company'" [formGroup]="createCompanyForm" (ngSubmit)="submitCompany()">

          <div class="row">

            <div class="col-6 mb-3">
              <label>Company Name
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" formControlName="companyName">
              <small class="error-message" *ngIf="createCompanyForm.controls['companyName'].errors?.['required'] && createCompanyForm.controls['companyName'].touched">This field is Required</small>
              <small class="error-message" *ngIf="createCompanyForm.controls['companyName'].errors?.['notUnique']">Company name is already exist!</small>
            </div>

            <div class="col-6 mb-3">
              <label> Abbreviation
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" formControlName="abbreviation">
              <small class="error-message" *ngIf="createCompanyForm.controls['abbreviation'].errors?.['required'] && createCompanyForm.controls['abbreviation'].touched">This field is Required</small>
              <small class="error-message" *ngIf="createCompanyForm.controls['abbreviation'].errors?.['notUnique']">Company Abbreviation is already exist!</small>
            </div>

            <div class="col-6 mb-3">
              <label> GST Number
                <!-- <span class="required">*</span> -->
              </label>
              <input type="text" class="form-control" formControlName="GSTNumber">
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['GSTNumber'].errors?.['required'] && createCompanyForm.controls['GSTNumber'].touched">This field is Required</small> -->
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['GSTNumber'].errors?.['notUnique']">Company name is already exist!</small> -->
            </div>

            <div class="col-6 mb-3">
              <input type="text" class="form-control" formControlName="address">
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['address'].errors?.['required'] && createCompanyForm.controls['address'].touched">This field is Required</small> -->
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['address'].errors?.['notUnique']">Company name is already exist!</small> -->
            </div>

          </div>

          <div class="text-end">
            <button type="submit" class="btn btn-submit" [disabled]="createCompanyForm.invalid">
              Save
            </button>
          </div>
        </form>

      </div>

    </div>
  </div>
</div>

<!-- UNIVERSAL EDIT MODAL -->
<div class="modal modal-sm fade" id="editModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">

  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          Edit {{activeSection | titlecase}}
        </h5>
        <button type="button" id="editModalCloseBtn" class="btn-close" data-bs-dismiss="modal"> </button>
      </div>

      <div class="modal-body">

        <!-- CATEGORY -->
        <form *ngIf="activeSection==='category'" [formGroup]="editCategoryForm" (ngSubmit)="submitEditCategory()">

          <label> Category Name <span class="required">*</span></label>
          <input type="text" class="form-control" formControlName="categoryName">

          <small *ngIf="editCategoryForm.controls['categoryName'].errors?.['required'] && editCategoryForm.controls['categoryName'].touched" class="error-message">This field is required</small>
          <small *ngIf="editCategoryForm.controls['categoryName'].errors?.['notUnique'] && editCategoryForm.controls['categoryName'].touched" class="error-message">Name already exists!</small>

          <div class="text-end mt-3">
            <button type="submit" class="btn btn-submit" [disabled]="editCategoryForm.invalid">Update</button>
          </div>
        </form>

        <!-- SUPPLIER -->
        <form *ngIf="activeSection==='supplier'" [formGroup]="editSupplierForm" (ngSubmit)="submitEditSupplier()">
          <div class="row">

            <!-- Supplier Name -->
            <div class="col-6 mb-3">
              <label> Supplier Name <span class="required">*</span></label>
              <input type="text" class="form-control" formControlName="supplierName">

              <small class="error-message"
                *ngIf="editSupplierForm.controls['supplierName'].errors?.['required'] && editSupplierForm.controls['supplierName'].touched">
                This field is Required
              </small>
              <small class="error-message"
                *ngIf="editSupplierForm.controls['supplierName'].errors?.['notUnique']">
                Supplier name is already exist!
              </small>
            </div>

            <!-- Contact person -->
            <div class="col-6 mb-3">
              <label> Contact Person </label>
              <input type="text" class="form-control" formControlName="contactPerson">
            </div>

            <!-- Contact Number -->
            <div class="col-6 mb-3">
              <label>Contact Number </label>
              <input type="text" class="form-control" formControlName="contactNumber">
              <!-- <small class="error-message" *ngIf="editSupplierForm.controls['contactNumber'].errors?.['notUnique']">Supplier name is already exist!</small> -->
            </div>

            <!-- Email -->
            <div class="col-6 mb-3">
              <label>E-Mail </label>
              <input type="text" class="form-control" formControlName="email">
              <!-- <small class="error-message" *ngIf="editSupplierForm.controls['email'].errors?.['notUnique']">Supplier name is already exist!</small> -->
            </div>

            <!-- GST Number -->
            <div class="col-6 mb-3">
              <label> GST Number </label>
              <input type="text" class="form-control" formControlName="GSTNumber">
              <!-- <small class="error-message" *ngIf="editSupplierForm.controls['GSTNumber'].errors?.['notUnique']">Supplier name is already exist!</small> -->
            </div>

            <!-- Address -->
            <div class="col-6 mb-3">
              <label> Address </label>
              <input type="text" class="form-control" formControlName="address">
            </div>

            <!-- Type -->
            <div class="col-6 mb-3">
              <label> Type </label>
              <select class="form-select form-control" aria-label="Default select example" formControlName="type">
                <option value="Local" class="type-option">Local</option>
                <option value="Imported" class="type-option">Imported</option>
              </select>
            </div>
          </div>

          <div class="text-end mt-3">
            <button type="submit" class="btn btn-submit" [disabled]="editSupplierForm.invalid">Update</button>
          </div>
        </form>

        <!-- LOCATION -->
        <form *ngIf="activeSection==='location'" [formGroup]="editLocationForm" (ngSubmit)="submitEditLocation()">

          <div class="row">
            <div class="col-6 mb-3">
              <label>Location Name <span class="required">*</span></label>
              <input type="text" class="form-control" formControlName="locationName">

              <small class="error-message"
                *ngIf="editLocationForm.controls['locationName'].errors?.['required'] && editLocationForm.controls['locationName'].touched">
                This field is Required
              </small>
              <small class="error-message"
                *ngIf="editLocationForm.controls['locationName'].errors?.['notUnique']">
                Location name is already exist!
              </small>
            </div>

            <div class="col-6 mb-3">
              <label>Shelf Location <span class="required">*</span> </label>
              <input type="text" class="form-control" formControlName="shelfLocation">

              <small
                *ngIf="editLocationForm.controls['shelfLocation']?.errors?.['maxlength'] && editLocationForm.controls['shelfLocation']?.touched" class="error-message">
                Name cannot exceed 30 characters.
              </small>
            </div>
          </div>

          <div class="text-end mt-3">
            <button type="submit" class="btn btn-submit" [disabled]="editLocationForm.invalid">Update</button>
          </div>
        </form>

        <!-- COMPANY -->
        <form *ngIf="activeSection==='company'" [formGroup]="editCompanyForm" (ngSubmit)="submitEditCompany()">
          <div class="row">
            <!-- Company Name -->
            <div class="col-6 mb-3">
              <label>Company Name
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" formControlName="companyName">
              <small class="error-message" *ngIf="editCompanyForm.controls['companyName'].errors?.['required'] && editCompanyForm.controls['companyName'].touched">This field is Required</small>
              <small class="error-message" *ngIf="editCompanyForm.controls['companyName'].errors?.['notUnique']">Company name is already exist!</small>
            </div>

            <!-- Abbreviation -->
            <div class="col-6 mb-3">
              <label> Abbreviation
                <span class="required">*</span>
              </label>
              <input type="text" class="form-control" formControlName="abbreviation">
              <small class="error-message" *ngIf="editCompanyForm.controls['abbreviation'].errors?.['required'] && editCompanyForm.controls['abbreviation'].touched">This field is Required</small>
              <small class="error-message" *ngIf="editCompanyForm.controls['abbreviation'].errors?.['notUnique']">Company Abbreviation is already exist!</small>
            </div>

            <!-- GST Number -->
            <div class="col-6 mb-3">
              <label> GST Number
                <!-- <span class="required">*</span> -->
              </label>
              <input type="text" class="form-control" formControlName="GSTNumber">
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['GSTNumber'].errors?.['required'] && createCompanyForm.controls['GSTNumber'].touched">This field is Required</small> -->
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['GSTNumber'].errors?.['notUnique']">Company name is already exist!</small> -->
            </div>

            <!-- Address -->
            <div class="col-6 mb-3">
              <label> Address
                <!-- <span class="required">*</span> -->
              </label>
              <input type="text" class="form-control" formControlName="address">
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['address'].errors?.['required'] && createCompanyForm.controls['address'].touched">This field is Required</small> -->
              <!-- <small class="error-message" *ngIf="createCompanyForm.controls['address'].errors?.['notUnique']">Company name is already exist!</small> -->
            </div>
          </div>

          <div class="text-end mt-3">
            <button type="submit" class="btn btn-submit" [disabled]="editCompanyForm.invalid">Update</button>
          </div>
        </form>

      </div>

    </div>
  </div>
</div>
