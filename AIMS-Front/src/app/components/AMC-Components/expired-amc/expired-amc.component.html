<div class="">
  <table class="table table-responsive table-striped">
    <thead>
      <tr>
        <th scope="col" class="align-middle text-center background-dark">AMC Name</th>
        <th scope="col" class="align-middle text-center background-dark">Start Date</th>
        <th scope="col" class="align-middle text-center background-dark">End Date</th>
        <th scope="col" class="align-middle text-center background-dark">Number of Assets</th>
        <th scope="col" class="align-middle text-center background-dark" colspan="2">Action</th>
      </tr>
    </thead>

    <tbody>
      <tr class="value-row" *ngFor="let item of expiredAMCList" (click)="openDetails(item)" style="cursor: pointer;">
        <th class="align-middle text-center" data-bs-toggle="modal" data-bs-target="#expiredAMCDetails">
          {{item.amcName}} </th>
        <td class="align-middle text-center" data-bs-toggle="modal" data-bs-target="#expiredAMCDetails">
          {{item.startDate | date:'shortDate' }} - {{item.startDate | date:'shortTime'}} </td>
        <td class="align-middle text-center" data-bs-toggle="modal" data-bs-target="#expiredAMCDetails"> {{item.endDate
          | date: 'shortDate'}} - {{item.endDate | date: 'shortTime'}} </td>
        <td class="align-middle text-center" data-bs-toggle="modal" data-bs-target="#expiredAMCDetails">
          {{item.coveredAssets.length}} </td>
        <td class="align-middle text-center" data-bs-toggle="modal" data-bs-target="#expiredAMCDetails">
          <button class="btn btn-action" data-bs-toggle="modal" data-bs-target="#expiredAMCEdit"
            (click)="openEdit(item)"> Renew </button>
        </td>
        <td class="align-middle text-center" data-bs-toggle="modal" data-bs-target="#expiredAMCDetails">
          <button type="button" data-bs-toggle="modal" data-bs-target="#expiredAMCHistory" class="btn btn-action"
            (click)="openHistory(item)"> History </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="row mt-2">
    <div class="col-md-6">
      <div class="select-pageNo">
        <label class="form-label"><b>Results per page</b></label>
        <select class="form-select form-select-sm " [(ngModel)]="pageLimit" (change)="changeDataLimit()">
          <option value="10">10</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
    </div>

    <div class="col-md-6 text-end">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-end">

          <!-- First -->
          <li class="page-item" [class.disabled]="currentPageNo === 1">
            <button class="page-link font-size-pagination" (click)="goToFirstPage()">&laquo;&laquo;</button>
          </li>

          <!-- Prev -->
          <li class="page-item" [class.disabled]="currentPageNo === 1">
            <button class="page-link font-size-pagination" (click)="previousPage()">&lsaquo;</button>
          </li>

          <!-- Dynamic pages -->
          <li *ngFor="let page of getPagesToShow()" class="page-item" [class.active]="currentPageNo === page">
            <button class="page-link font-size-pagination" (click)="goToPage(page)">{{ page }}</button>
          </li>

          <!-- Next -->
          <li class="page-item" [class.disabled]="currentPageNo === totalPages">
            <button class="page-link font-size-pagination" (click)="nextPage()">&rsaquo;</button>
          </li>

          <!-- Last -->
          <li class="page-item" [class.disabled]="currentPageNo === totalPages">
            <button class="page-link font-size-pagination" (click)="goToLastPage()">&raquo;&raquo;</button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Details view Section -->
<div class="modal modal-xl fade" id="expiredAMCDetails" tabindex="-1" aria-labelledby="expiredAMCDetailsLabel"
  data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header justify-content-between">
        <h5 class="modal-title">{{selectedAMC?.amcName}}</h5>
        <div class="right-btns">
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"
            (click)="clearSelection()"></button>
        </div>
      </div>

      <div class="modal-body">
        <div class="row-detail">
          <div class="text-container">
            <p class="detailsHeading">AMC Name:</p>
            <p class="detailsValue">{{selectedAMC?.amcName ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Assets Code:</p>
            <p class="detailsValue">{{selectedAMC?.assetsCode ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Start Date:</p>
            <p class="detailsValue">{{selectedAMC?.startDate ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">End Date:</p>
            <p class="detailsValue">{{selectedAMC?.endDate ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Service Provider:</p>
            <p class="detailsValue">{{selectedAMC?.serviceProvider ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Invoice Number:</p>
            <p class="detailsValue">{{selectedAMC?.invoiceNumber ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Cost:</p>
            <p class="detailsValue">{{selectedAMC?.cost ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">AMC Type:</p>
            <p class="detailsValue">{{selectedAMC?.amcType ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Frequency:</p>
            <p class="detailsValue">{{selectedAMC?.frequency ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Payment Mode:</p>
            <p class="detailsValue">{{selectedAMC?.paymentMode ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Payment Info:</p>
            <p class="detailsValue">{{selectedAMC?.paymentInfo ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Additional Notes:</p>
            <p class="detailsValue">{{selectedAMC?.additionalNotes ?? '--'}}</p>
          </div>
          <div class="text-container">
            <p class="detailsHeading">Status:</p>
            <p class="detailsValue">{{selectedAMC?.status ?? '--'}}</p>
          </div>
        </div>

        <div class=" row card-body">
          <div class="card col-md-12">
            <div class="card-body p-0">
              <p class="m-1 detailsHeading">Covered Assets</p>
              <hr class="m-0">
              <div class="accordion m-2" id="coveredAssetsAcc">
                <div class="accordion-item border border-danger-subtle"
                  *ngFor="let items of selectedAMC?.coveredAssets; let i = index">

                  <h2 class="accordion-header">
                    <button class="accordion-button assetsHeading p-2" type="button" data-bs-toggle="collapse"
                      [attr.data-bs-target]="'#activeDetails'+i" [attr.aria-controls]="'collapse'+i"
                      style="background-color: var(--bg-light-red2);">
                      {{ items.department }}
                    </button>
                  </h2>

                  <!-- <div [id]="'collapse'+i" class="accordion-collapse collapse" [class.show]="i === 0"> -->
                  <div [id]="'activeDetails'+i" class="accordion-collapse collapse" [class.show]="true">
                    <div class="accordion-body" class="modal-dialog-scrollable table-scroll-details">

                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th *ngFor="let h of getHeaders(items.assets)">
                              {{ toDisplayName(h) }}
                            </th>
                          </tr>
                        </thead>

                        <tbody>
                          <tr *ngFor="let asset of items.assets">
                            <td *ngFor="let h of getHeaders(items.assets)">
                              {{ resolveValue(asset, h, items.department) }}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Renew Modal Section -->
<div class="modal modal-lg fade" id="expiredAMCEdit" tabindex="-1" aria-labelledby="expiredAMCRenewModalLabel"
  data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="expiredAMCRenewModalLabel">{{selectedAMC?.amcName}}</h1>
        <button type="button" id="closeModalCreate" class="btn-close btn-close-white" data-bs-dismiss="modal"
          aria-label="Close" (click)="clearReNewForm()"></button>
      </div>
      <div class="modal-body">
        <div class="form-container">
          <form [formGroup]="reNewAMCForm" class="row g-3" (ngSubmit)="submitReNewAMC()">
            <div class="col-md-3 form-group">
              <label class="form-label">AMC Name <span class="required">*</span> </label>
              <input type="text" class="form-control" formControlName="amcName" />
              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['amcName'].errors?.['required'] && reNewAMCForm.controls['amcName'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">ID <span class="required">*</span> </label>
              <input type="text" class="form-control" formControlName="id" />
              <div class="error-message">
                <small *ngIf="reNewAMCForm.controls['id'].errors?.['required'] && reNewAMCForm.controls['id'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">Start Date <span class="required">*</span> </label>
              <input type="date" class="form-control" formControlName="startDate" />
              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['startDate'].errors?.['required'] && reNewAMCForm.controls['startDate'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">End Date <span class="required">*</span> </label>
              <input type="date" class="form-control" formControlName="endDate" />

              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['endDate'].errors?.['required'] && reNewAMCForm.controls['endDate'].touched">
                  This field is required.
                </small>
                <small *ngIf="reNewAMCForm.errors?.['dateRangeInvalid']">
                  End Date must be greater than Start Date.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">Service Provider <span class="required">*</span> </label>
              <input type="text" class="form-control" formControlName="serviceProvider" />
              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['serviceProvider'].errors?.['required'] && reNewAMCForm.controls['serviceProvider'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">Invoice Number <span class="required">*</span> </label>
              <input type="number" class="form-control" formControlName="invoiceNumber" />
              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['invoiceNumber'].errors?.['required'] && reNewAMCForm.controls['invoiceNumber'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">Cost <span class="required">*</span> </label>
              <input type="number" class="form-control" formControlName="cost" />
              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['cost'].errors?.['required'] && reNewAMCForm.controls['cost'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">AMC Type <span class="required">*</span> </label>
              <ng-select [items]="amcType" bindLabel="name" bindValue="_id" formControlName="amcType"
                [searchable]="true" [addTag]="true" placeholder="Select AMC Type">
              </ng-select>
              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['amcType'].errors?.['required'] && reNewAMCForm.controls['amcType'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">Frequency <span class="required">*</span> </label>
              <ng-select [items]="amcFrequency" bindLabel="name" bindValue="_id" formControlName="frequency"
                [searchable]="true" [addTag]="true" placeholder="Select AMC Frequency">
              </ng-select>
              <div class="error-message">
                <small
                  *ngIf="reNewAMCForm.controls['frequency'].errors?.['required'] && reNewAMCForm.controls['frequency'].touched">
                  This field is required.
                </small>
              </div>
            </div>

            <div class="col-md-3 form-group">
              <label class="form-label">Payment Mode </label>
              <input type="text" class="form-control" formControlName="paymentMode" />
            </div>

            <div class="col-md-6 form-group">
              <label class="form-label">Payment Info </label>
              <input type="text" class="form-control" formControlName="paymentInfo" />
            </div>

            <div class="col-md-6 form-group">
              <label class="form-label">Additional Notes</label>
              <input type="text" class="form-control" formControlName="additionalNotes" />
            </div>

            <div class="col-12">
              <button class="btn" type="submit" [disabled]="reNewAMCForm.invalid">Submit </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- History Modal Section -->
<div class="modal modal-xl fade" id="expiredAMCHistory" tabindex="-1" aria-labelledby="expiredAMCHistoryLabel"
  data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="expiredAMCHistoryLabel">{{selectedName}}</h5>
        <div class="color-cot">
          <!-- Uncomment and adjust as necessary -->
          <div class="color">
            <input class="form-check-input search-box" name="historyFilter" [(ngModel)]="selectedFilterHistory"
              type="radio" checked value="all" (change)="changeHisttoryFilter($event)">
            All
          </div>
          <div class="color">
            <input class="form-check-input search-box" name="historyFilter" [(ngModel)]="selectedFilterHistory"
              type="radio" value="create" (change)="changeHisttoryFilter($event)">
            <div class="create box"></div>
            Create
          </div>
          <div class="color">
            <input class="form-check-input search-box" type="radio" name="historyFilter"
              [(ngModel)]="selectedFilterHistory" value="service initiate" (change)="changeHisttoryFilter($event)">
            <div class="InitiateService box"></div>
            Initiate Service
          </div>
          <div class="color">
            <input class="form-check-input search-box" name="historyFilter" type="radio"
              [(ngModel)]="selectedFilterHistory" value="close service" (change)="changeHisttoryFilter($event)">
            <div class="CloseService box"></div>
            Close Service
          </div>
          <div class="color">
            <input class="form-check-input search-box" name="historyFilter" type="radio"
              [(ngModel)]="selectedFilterHistory" value="repair initiate" (change)="changeHisttoryFilter($event)">
            <div class="InitiateRepair box"></div>
            Initiate Repair
          </div>
          <div class="color">
            <input class="form-check-input search-box" name="historyFilter" type="radio"
              [(ngModel)]="selectedFilterHistory" value="close repair" (change)="changeHisttoryFilter($event)">
            <div class="CloseRepair box"></div>
            Close Repair
          </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Content for stock history goes here -->
        <div class="stockHistoryTable-container">
          <div class="table-scroll-history">
            <table class="table table-responsive table-striped">
              <thead>
                <tr>
                  <th scope="col" class="col-header align-middle background-dark">#</th>
                  <th scope="col" class="col-header align-middle background-dark">Date</th>
                  <th scope="col" class="col-header align-middle background-dark">Transaction</th>
                  <th scope="col" class="col-header align-middle background-dark">Service No.</th>
                  <th scope="col" class="col-header align-middle background-dark">Service Status</th>
                  <th scope="col" class="col-header align-middle background-dark">Serviced Asset</th>
                  <th scope="col" class="col-header align-middle background-dark">Note</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let item of historyList; let i = index">
                  <tr [ngClass]="{'table-active': selectedRow === i,'cursor-pointer': item}"
                    (click)="toggleCollapse(i)">
                    <th scope="row" class="align-middle col-data">{{i+1}}</th>
                    <td class="align-middle col-data">{{item.createdAt | date:'shortDate'}} - {{item.createdAt
                      |date:'shortTime'}}</td>
                    <td class="align-middle col-data">{{item.transactionType || '--'}}</td>
                    <td class="align-middle col-data">{{item.serviceNumber || '--'}}</td>
                    <td class="align-middle col-data">{{item.serviceStatus || '--'}}</td>
                    <td class="align-middle col-data">{{item.servicedAssets.length || '--'}}</td>
                    <td class="align-middle col-data">{{item.additionalNotes || '--'}}</td>
                  </tr>

                  <tr *ngIf="selectedRow === i">
                    <td colspan="8" class="p-0 border-0">
                      <div [id]="'collapse' + i" class="accordion-collapse collapse" [ngClass]="{show: item }">
                        <div class="accordion-body" *ngIf="item !== null">
                          <table class="table table-responsive m-0">
                            <thead>
                              <tr>
                                <th scope="col" class="col-header align-middle background-dark">Bill No</th>
                                <th scope="col" class="col-header align-middle background-dark">Cost</th>
                                <th scope="col" class="col-header align-middle background-dark">Estimated Cost</th>
                                <th scope="col" class="col-header align-middle background-dark">Payment Info</th>
                                <th scope="col" class="col-header align-middle background-dark">Payment Mode</th>
                                <th scope="col" class="col-header align-middle background-dark">Service Details</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>{{item?.billNo !== null || undefined || "" ? item?.billNo : '--'}}</td>
                                <td>{{item?.cost !== null || undefined || "" ? item?.cost : '--' }}</td>
                                <td>{{item?.estimatedCost !== null || undefined || "" ? item?.estimatedCost : '--' }}
                                </td>
                                <td>{{item?.paymentInfo !== null || undefined || "" ? item?.paymentInfo : '--' }}</td>
                                <td>{{item?.paymentMode !== null || undefined || "" ? item?.paymentMode : '--' }}</td>
                                <td>{{item?.serviceDetails !== null || undefined || "" ? item?.serviceDetails : '--' }}
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="accordion-body" *ngIf="item === null">
                          <table class="table table-responsive m-0">
                            <tbody>
                              <tr>
                                <th scope="row">Component Stock Is Moved from
                                  <!-- {{projectNameList[stockHistory.movedFromProjectName]}} to -->
                                  <!-- {{projectNameList[stockHistory.projectName]}} -->
                                </th>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
